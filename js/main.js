// Define all your maps first
var blankMap = L.map('blankMap', {
  center: [0, 0],
  zoom: 2,
  maxZoom: 18,
  minZoom: 1,
  scrollWheelZoom: false,
  zoomControl: true
});

var blankMap2 = L.map('blankMap2', {
  center: [0, 0],
  zoom: 2,
  maxZoom: 18,
  minZoom: 1,
  scrollWheelZoom: false,
  zoomControl: true
});

var breedingMap = L.map('breedingMap', {
  center: [0, 0],
  zoom: 2,
  maxZoom: 18,
  minZoom: 1,
  scrollWheelZoom: false,
  zoomControl: true
});

var pointsMap = L.map('pointsMap', {
  center: [0, 0],
  zoom: 2,
  maxZoom: 18,
  minZoom: 1,
  scrollWheelZoom: false,
  zoomControl: true
});

var climateMap = L.map('climateMap', {
  center: [0, 0],
  zoom: 2,
  maxZoom: 18,
  minZoom: 1,
  scrollWheelZoom: false,
  zoomControl: true
});

var nonBreedingMap = L.map('nonBreedingMap', {
  center: [0, 0],
  zoom: 2,
  maxZoom: 18,
  minZoom: 1,
  scrollWheelZoom: false,
  zoomControl: true
});

var iceMap = L.map('iceMap', {
  center: [0, 0],
  zoom: 2,
  maxZoom: 18,
  minZoom: 1,
  scrollWheelZoom: false,
  zoomControl: true
});

var points2Map = L.map('points2Map', {
  center: [0, 0],
  zoom: 2,
  maxZoom: 18,
  minZoom: 1,
  scrollWheelZoom: false,
  zoomControl: true
});

var stepMap1 = L.map('stepMap1', {
  center: [0, 0],
  zoom: 2,
  maxZoom: 18,
  minZoom: 1,
  scrollWheelZoom: false,
  zoomControl: true
});

var stepMap2 = L.map('stepMap2', {
  center: [0, 0],
  zoom: 2,
  maxZoom: 18,
  minZoom: 1,
  scrollWheelZoom: false,
  zoomControl: true
});

var stepMap3 = L.map('stepMap3', {
  center: [0, 0],
  zoom: 2,
  maxZoom: 18,
  minZoom: 1,
  scrollWheelZoom: false,
  zoomControl: true
});

var stepMap4 = L.map('stepMap4', {
  center: [0, 0],
  zoom: 2,
  maxZoom: 18,
  minZoom: 1,
  scrollWheelZoom: false,
  zoomControl: true
});

var stepMap5 = L.map('stepMap5', {
  center: [0, 0],
  zoom: 2,
  maxZoom: 18,
  minZoom: 1,
  scrollWheelZoom: false,
  zoomControl: true
});

var stepMap6 = L.map('stepMap6', {
  center: [0, 0],
  zoom: 2,
  maxZoom: 18,
  minZoom: 1,
  scrollWheelZoom: false,
  zoomControl: true
});

var stepMap7 = L.map('stepMap7', {
  center: [0, 0],
  zoom: 2,
  maxZoom: 18,
  minZoom: 1,
  scrollWheelZoom: false,
  zoomControl: true
});

var stepMap8 = L.map('stepMap8', {
  center: [0, 0],
  zoom: 2,
  maxZoom: 18,
  minZoom: 1,
  scrollWheelZoom: false,
  zoomControl: true
});

var stepMap9 = L.map('stepMap9', {
  center: [0, 0],
  zoom: 2,
  maxZoom: 18,
  minZoom: 1,
  scrollWheelZoom: false,
  zoomControl: true
});

var stepMap10 = L.map('stepMap10', {
  center: [0, 0],
  zoom: 2,
  maxZoom: 18,
  minZoom: 1,
  scrollWheelZoom: false,
  zoomControl: true
});

var stepMap11 = L.map('stepMap11', {
  center: [0, 0],
  zoom: 2,
  maxZoom: 18,
  minZoom: 1,
  scrollWheelZoom: false,
  zoomControl: true
});

var stepMap12 = L.map('stepMap12', {
  center: [0, 0],
  zoom: 2,
  maxZoom: 18,
  minZoom: 1,
  scrollWheelZoom: false,
  zoomControl: true
});

var stepMap13 = L.map('stepMap13', {
  center: [0, 0],
  zoom: 2,
  maxZoom: 18,
  minZoom: 1,
  scrollWheelZoom: false,
  zoomControl: true
});

var stepMap14 = L.map('stepMap14', {
  center: [0, 0],
  zoom: 2,
  maxZoom: 18,
  minZoom: 1,
  scrollWheelZoom: false,
  zoomControl: true
});

var stepMap15 = L.map('stepMap15', {
  center: [0, 0],
  zoom: 2,
  maxZoom: 18,
  minZoom: 1,
  scrollWheelZoom: false,
  zoomControl: true
});

var stepMap16 = L.map('stepMap16', {
  center: [0, 0],
  zoom: 2,
  maxZoom: 18,
  minZoom: 1,
  scrollWheelZoom: false,
  zoomControl: true
});

var stepMap17 = L.map('stepMap17', {
  center: [0, 0],
  zoom: 2,
  maxZoom: 18,
  minZoom: 1,
  scrollWheelZoom: false,
  zoomControl: true
});

var stepMap18 = L.map('stepMap18', {
  center: [0, 0],
  zoom: 2,
  maxZoom: 18,
  minZoom: 1,
  scrollWheelZoom: false,
  zoomControl: true
});

var stepMap19 = L.map('stepMap19', {
  center: [0, 0],
  zoom: 2,
  maxZoom: 18,
  minZoom: 1,
  scrollWheelZoom: false,
  zoomControl: true
});

var stepMap20 = L.map('stepMap20', {
  center: [0, 0],
  zoom: 2,
  maxZoom: 18,
  minZoom: 1,
  scrollWheelZoom: false,
  zoomControl: true
});

var stepMap21 = L.map('stepMap21', {
  center: [0, 0],
  zoom: 2,
  maxZoom: 18,
  minZoom: 1,
  scrollWheelZoom: false,
  zoomControl: true
});

var sliderMap;


// Add base tile layers
const tileMaps = [blankMap, blankMap2, breedingMap, pointsMap, climateMap, nonBreedingMap, iceMap, points2Map, stepMap1, stepMap2, stepMap3, stepMap4,
  stepMap5, stepMap6, stepMap7, stepMap8, stepMap9, stepMap10, stepMap11, stepMap12, stepMap13, stepMap14, stepMap15, stepMap16, stepMap17, stepMap18,
  stepMap19, stepMap20, stepMap21
];
tileMaps.forEach(function(map) {
  L.tileLayer('https://api.mapbox.com/styles/v1/smichalski/clgpx6cap00e901nn9jbi9fyt/tiles/256/{z}/{x}/{y}@2x?access_token=pk.eyJ1Ijoic21pY2hhbHNraSIsImEiOiJjbDl6d2s0enYwMnI1M29uMDhzNXB0NTRlIn0.c1_vy157AkEEGNIfyQI9YQ', {
    maxZoom: 18
  }).addTo(map);
});

// tern points down styling 
function styleTernPointsDown(feature) {
  return {
    radius: 4,
    fillColor: "white",
    color: "red",
    weight: 1,
    opacity: 1,
    fillOpacity: 0.9
  };
}

// climate zone polygon styling 
function styleClimateZone(feature) {
  const dn = feature.properties.DN;
  const colorMap = {
    1: '#a50026',
    2: '#d73027',
    3: '#f46d43',
    4: '#fdae61',
    5: '#fee090',
    6: '#ffffbf',
    7: '#e0f3f8',
    8: '#abd9e9',
    9: '#74add1',
    10: '#4575b4',
    11: '#313695',
    12: '#800080',
    13: '#FF00FF',
    14: '#00FFFF',
    15: '#008080',
    16: '#00FF00',
    17: '#ADFF2F',
    18: '#FFD700',
    19: '#FFA500',
    20: '#FF6347',
    21: '#CD5C5C',
    22: '#8B0000',
    23: '#2F4F4F',
    24: '#708090',
    25: '#000080',
    26: '#191970',
    27: '#483D8B',
    28: '#6A5ACD',
    29: '#7B68EE',
    30: '#9370DB'
  };

  return {
    fillColor: colorMap[dn] || '#cccccc',
    color: '#333',
    weight: 1,
    fillOpacity: 0.6
  };
}

// tern points up styling 
function styleTernPointsUp(feature) {
  return {
    radius: 4,
    fillColor: "red",
    color: "white",
    weight: 1,
    opacity: 1,
    fillOpacity: 0.9
  };
}

// Reusable data loader function for project (can accept style function)
function getData(map, url, iconUrl, customStyle) {
  fetch(url)
    .then(response => response.json())
    .then(json => {
      L.geoJson(json, {
        style: customStyle,  // ‚Üê apply style if it's passed
        pointToLayer: function (feature, latlng) {
          if (iconUrl) {
            var customIcon = L.icon({
              iconUrl: iconUrl,
              iconSize: [30, 30],
              iconAnchor: [15, 15]
            });
            return L.marker(latlng, { icon: customIcon });
          } else {
            return L.circleMarker(latlng, {
              radius: 6,
              fillColor: "#ff7800",
              color: "#000",
              weight: 1,
              opacity: 1,
              fillOpacity: 0.8
            });
          }
        },
        onEachFeature: function (feature, layer) {
          let popupContent = "";
          for (let property in feature.properties) {
            popupContent += `<p><strong>${property}</strong>: ${feature.properties[property]}</p>`;
          }
          layer.bindPopup(popupContent);
        }
      }).addTo(map);
    })
    .catch(error => console.error(`Error loading ${url}:`, error));
}

// tern steps points style 
function styleStepPoints(feature) {
  return {
    radius: 4,
    fillColor: "purple",
    color: "orange",
    weight: 1,
    opacity: 1,
    fillOpacity: 0.9
  };
}

// Load data layers onto the maps
// style breeding range layer
getData(breedingMap, 'data/breeding-range.geojson', null, {
  color: "#1f78b4",          // outline color
  weight: 2,                 // outline thickness
  fillColor: "#444",      // fill color
  fillOpacity: 1           // fill transparency
});

// get first points layer
getData(pointsMap, 'data/tern-points-down.geojson', null, styleTernPointsDown);

// get climate zone data + style 
getData(climateMap, 'data/climate-zones.geojson', null, styleClimateZone);

// style non breeding range layer
getData(nonBreedingMap, 'data/non-breeding-range.geojson', null, {
  color: "#1f78b4",          // outline color
  weight: 2,                 // outline thickness
  fillColor: "#444",      // fill color
  fillOpacity: 1           // fill transparency
});

// get second points layer
getData(points2Map, 'data/tern-points-up.geojson', null, styleTernPointsUp);

// style sea ice layer 
getData(iceMap, 'data/sea-ice-trace.geojson', null, {
  color: "#1f78b4",          // outline color
  weight: 2,                 // outline thickness
  fillColor: "#444",      // fill color
  fillOpacity: 1           // fill transparency
});

getData(stepMap1, 'data/step1.geojson', null, styleStepPoints);
getData(stepMap2, 'data/step2.geojson', null, styleStepPoints);
getData(stepMap3, 'data/step3.geojson', null, styleStepPoints);
getData(stepMap4, 'data/step4.geojson', null, styleStepPoints);
getData(stepMap5, 'data/step5.geojson', null, styleStepPoints);
getData(stepMap6, 'data/step6.geojson', null, styleStepPoints);
getData(stepMap7, 'data/step7.geojson', null, styleStepPoints);
getData(stepMap8, 'data/step8.geojson', null, styleStepPoints);
getData(stepMap9, 'data/step9.geojson', null, styleStepPoints);
getData(stepMap10, 'data/step10.geojson', null, styleStepPoints);
getData(stepMap11, 'data/step11.geojson', null, styleStepPoints);
getData(stepMap12, 'data/step12.geojson', null, styleStepPoints);
getData(stepMap13, 'data/step13.geojson', null, styleStepPoints);
getData(stepMap14, 'data/step14.geojson', null, styleStepPoints);
getData(stepMap15, 'data/step15.geojson', null, styleStepPoints);
getData(stepMap16, 'data/step16.geojson', null, styleStepPoints);
getData(stepMap17, 'data/step17.geojson', null, styleStepPoints);
getData(stepMap18, 'data/step18.geojson', null, styleStepPoints);
getData(stepMap19, 'data/step19.geojson', null, styleStepPoints);
getData(stepMap20, 'data/step20.geojson', null, styleStepPoints);
getData(stepMap21, 'data/step21.geojson', null, styleStepPoints);



// call mapbox 
mapboxgl.accessToken = 'pk.eyJ1Ijoic21pY2hhbHNraSIsImEiOiJjbDl6d2s0enYwMnI1M29uMDhzNXB0NTRlIn0.c1_vy157AkEEGNIfyQI9YQ';

function initMapboxTerrainMap(containerId, centerCoords, zoom = 10) {
  const map = new mapboxgl.Map({
    container: containerId,
    style: 'mapbox://styles/mapbox/standard-satellite',
    center: centerCoords,
    zoom: zoom,
    pitch: 60,
    bearing: -10,
    antialias: true
  });

  // Disable scroll-to-zoom so page scrolling works normally
  map.scrollZoom.disable();

  // Add zoom-only buttons (no compass)
  map.addControl(new mapboxgl.NavigationControl({ showCompass: false }), 'top-left');


  map.on('load', () => {
    map.addSource('mapbox-dem', {
      type: 'raster-dem',
      url: 'mapbox://mapbox.terrain-rgb',
      tileSize: 512,
      maxzoom: 14
    });

    map.setTerrain({ source: 'mapbox-dem', exaggeration: 1.5 });

    map.addLayer({
      id: 'sky',
      type: 'sky',
      paint: {
        'sky-type': 'atmosphere',
        'sky-atmosphere-sun': [0.0, 0.0],
        'sky-atmosphere-sun-intensity': 15
      }
    });
  });
}

// call mapbox gl js locations
initMapboxTerrainMap('glMapAlaska', [-167.55, 53.88], 9);
initMapboxTerrainMap('glMapOregon', [-124.3389555, 40.13996991], 12);
initMapboxTerrainMap('glMapEcuador', [-78.4678, -0.1807], 13);
initMapboxTerrainMap('glMapAntarctica', [-63.0333, -64.6333], 8);

// SLIDER MAP

// function to create Slider map
function createSliderMap(){

    sliderMap = L.map('sliderMap',{
        center: [39,-96],
        zoom: 5,
        maxZoom: 12,
        minZoom: 5,
        scrollWheelZoom: false,
        zoomControl: true});

    // mapbox layer 1
    var layer1 = L.tileLayer('https://api.mapbox.com/styles/v1/smichalski/clgpx6cap00e901nn9jbi9fyt/tiles/256/{z}/{x}/{y}@2x?access_token=pk.eyJ1Ijoic21pY2hhbHNraSIsImEiOiJjbDl6d2s0enYwMnI1M29uMDhzNXB0NTRlIn0.c1_vy157AkEEGNIfyQI9YQ', { 
        attribution: '&copy <a href="https://www.mapbox.com/map-feedback/">Mapbox</a> &copy <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
    }).addTo(sliderMap);

    // mapbox layer 2
    var layer2 = L.tileLayer('https://api.mapbox.com/styles/v1/ajnovak/cl2grbrgj003o14mot9tnmwh1/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoiYWpub3ZhayIsImEiOiJja2dnMWJoYXkwd3hlMnlsN241MHU3aTdyIn0.YlwTqHjnT8sUrhr8vtkWjg', { 
        attribution: '&copy <a href="https://www.mapbox.com/map-feedback/">Mapbox</a> &copy <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
    }).addTo(sliderMap);

    // compare two layers on map
    L.control.sideBySide(layer1, layer2).addTo(sliderMap);
    

    // create legend control holding svg legend and add to map
    var sliderLegend = L.Control.extend({
        options: {
            position: "bottomleft"
        },
        onAdd:function(){
            var sliderContainer = L.DomUtil.create('div','legend-control-container1');
            var svg = '<?xml version="1.0" encoding="UTF-8"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 260 55"><defs><style>.d{letter-spacing:-.015em;}.e{font-size:9px;}.e,.f{fill:#0f1031;font-family:AstoriaSans-Roman, Astoria Sans;}.g{fill:url(#c);}.h{letter-spacing:-.01004em;}.i{letter-spacing:.02002em;}.j{letter-spacing:-.01998em;}.f{font-size:11px;}.k{letter-spacing:-.01997em;}</style><linearGradient id="c" x1="13.02934" y1="27.5" x2="246.97012" y2="27.5" gradientTransform="matrix(1, 0, 0, 1, 0, 0)" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#0c1c2c"/><stop offset="1" stop-color="#f7f8e8"/></linearGradient></defs><g id="a"/><g id="b"><g><rect class="g" x="13.02934" y="18.11785" width="233.94077" height="18.7643"/><text class="f" transform="translate(99.91502 14.51568)"><tspan x="0" y="0">Visible S</tspan><tspan class="i" x="41.46924" y="0">t</tspan><tspan x="45.83643" y="0">a</tspan><tspan class="d" x="51.21533" y="0">r</tspan><tspan x="55.65918" y="0">s</tspan></text><text class="f" transform="translate(48.00135 48.13983)"><tspan x="0" y="0">Magnitude per Squa</tspan><tspan class="j" x="98.88916" y="0">r</tspan><tspan x="103.27832" y="0">e A</tspan><tspan class="j" x="119.96484" y="0">r</tspan><tspan x="124.354" y="0">csecond</tspan></text><text class="e" transform="translate(230.29321 15.03096)"><tspan class="h" x="0" y="0">L</tspan><tspan x="4.57178" y="0">ess</tspan></text><text class="e" transform="translate(13.02946 15.03084)"><tspan x="0" y="0">Mo</tspan><tspan class="k" x="12.93262" y="0">r</tspan><tspan x="16.52393" y="0">e</tspan></text><text class="e" transform="translate(225.65903 48.65596)"><tspan x="0" y="0">17.80</tspan></text><text class="e" transform="translate(13.02921 48.65584)"><tspan x="0" y="0">22.00</tspan></text></g></g></svg>'
            sliderContainer.insertAdjacentHTML('beforeend',svg)
            return sliderContainer;
        }
    });
    sliderMap.addControl(new sliderLegend()); 
};








/* arrow controls */
window.addEventListener("scroll", function () {
  const prompt = document.getElementById("scrollPrompt");
  if (prompt) {
    prompt.style.transition = "opacity 0.5s ease";
    prompt.style.opacity = "0";
    setTimeout(() => prompt.style.display = "none", 500);
  }
});


// Windy map interaction toggle buttons with styles and active state
document.addEventListener('DOMContentLoaded', function () {
  const windyMap = document.getElementById("windyMap");
  const iframeContainer = windyMap.querySelector(".iframe-container");

  const buttonContainer = document.createElement("div");
  buttonContainer.style.position = "absolute";
  buttonContainer.style.top = "10px";
  buttonContainer.style.left = "10px";
  buttonContainer.style.zIndex = "9999";
  buttonContainer.style.display = "flex";
  buttonContainer.style.gap = "10px";

  function createToggleButton(text) {
    const btn = document.createElement("button");
    btn.innerText = text;
    btn.className = "windy-toggle-btn";
    return btn;
  }

  const enableBtn = createToggleButton("Enable Map Interaction");
  const disableBtn = createToggleButton("Disable Map Interaction");

  function setActive(btn) {
    enableBtn.classList.remove("active");
    disableBtn.classList.remove("active");
    btn.classList.add("active");
  }

  enableBtn.addEventListener("click", () => {
    iframeContainer.style.pointerEvents = "auto";
    setActive(enableBtn);
  });

  disableBtn.addEventListener("click", () => {
    iframeContainer.style.pointerEvents = "none";
    setActive(disableBtn);
  });

  // Set initial state
  disableBtn.classList.add("active");
  iframeContainer.style.pointerEvents = "none";

  buttonContainer.appendChild(enableBtn);
  buttonContainer.appendChild(disableBtn);
  windyMap.appendChild(buttonContainer);
});

 


// Chart.js: Migration distances by species
document.addEventListener('DOMContentLoaded', function () {
  const chartCanvas = document.getElementById('migrationChart');
  if (!chartCanvas) return;  // Exit if chart container doesn't exist

  const ctx = chartCanvas.getContext('2d');

  const chart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: ['Arctic Tern', 'Wildebeest', 'Monarch Butterfly', 'Salmon', 'Gray Whale'],
      datasets: [{
        label: 'Annual Migration Distance (miles)',
        data: [44000, 1000, 3000, 2500, 10000],
        backgroundColor: 'rgba(93, 173, 226, 0.6)',
        borderColor: 'rgba(93, 173, 226, 1)',
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      plugins: {
        tooltip: {
          callbacks: {
            label: function(context) {
              return `${context.dataset.label}: ${context.formattedValue} mi`;
            }
          }
        }
      },
      scales: {
        y: {
          beginAtZero: true,
          title: {
            display: true,
            text: 'Miles'
          }
        }
      }
    }
  });
});

document.addEventListener('DOMContentLoaded', createSliderMap)
